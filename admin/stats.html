<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Thống kê - MINDÙK</title>
  <link rel="icon" href="../assets/images/logo.png" type="image/png">
  <link rel="stylesheet" href="../assets/css/admin/admin.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <i class="fa-solid fa-chart-bar logo-icon"></i>
        <span class="sidebar-title">MINDÙK</span>
      </div>
    </div>
    <div class="sidebar-menu">
      <label class="sidebar-menu-label">MENU</label>
      <nav class="nav-links">
        <a href="adminlmd.html">
          <span class="menu-icon-bg"><i class="fa-solid fa-table-cells-large menu-icon"></i></span>
          <span>Đặt bàn</span>
        </a>
        <a href="stats.html" class="active">
          <span class="menu-icon-bg"><i class="fa-solid fa-chart-line menu-icon"></i></span>
          <span>Thống kê</span>
        </a>
      </nav>
    </div>
  </aside>
  <main class="main" id="main">
    <header class="header">
      <button class="menu-btn" id="menu-btn"><i class="fa-solid fa-bars"></i></button>
      <div class="header-actions">
        <div class="user">
          <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" alt="admin" class="user-avatar">
          <span>LyeMinDuk</span>
        </div>
      </div>
    </header>
    <div class="table-header">
      <h2>Thống kê đặt bàn</h2>
    </div>
    <div class="stats-cards">
      <div class="stat-card">
        <span>Đơn đã xác nhận</span>
        <span id="stats-confirmed">0</span>
      </div>
      <div class="stat-card">
        <span>Đơn đã xóa</span>
        <span id="stats-deleted">0</span>
      </div>
    </div>
    <div class="table-wrapper" style="margin-top: 24px;">
      <table>
        <thead>
          <tr>
            <th>Tên</th>
            <th>Email</th>
            <th>SĐT</th>
            <th>Ngày</th>
            <th>Giờ</th>
            <th>Số người</th>
            <th>Trạng thái</th>
          </tr>
        </thead>
        <tbody id="stats-table-body"></tbody>
      </table>
    </div>
  </main>
  <script>
    document.getElementById('menu-btn').onclick = function () {
      document.getElementById('sidebar').classList.toggle('collapsed');
    };
    function getDeleted() {
      return JSON.parse(localStorage.getItem("deleted_reservations") || "[]");
    }
    function loadStats() {
      const confirmed = (JSON.parse(localStorage.getItem("reservations") || "[]")).filter(r => r.confirmed);
      const deleted = getDeleted();
      document.getElementById('stats-confirmed').textContent = confirmed.length;
      document.getElementById('stats-deleted').textContent = deleted.length;
      const statsTbody = document.getElementById('stats-table-body');
      statsTbody.innerHTML = '';
      confirmed.forEach(r => {
        statsTbody.innerHTML += `<tr>
          <td>${r.name}</td><td>${r.email}</td><td>${r.phone}</td>
          <td>${r.date}</td><td>${r.time}</td><td>${r.people}</td>
          <td>✅ Đã xác nhận</td>
        </tr>`;
      });
      deleted.forEach(r => {
        statsTbody.innerHTML += `<tr>
          <td>${r.name}</td><td>${r.email}</td><td>${r.phone}</td>
          <td>${r.date}</td><td>${r.time}</td><td>${r.people}</td>
          <td>❌ Đã xóa</td>
        </tr>`;
      });
    }
    window.addEventListener("storage", loadStats);
    window.addEventListener("reservationUpdated", loadStats);
    loadStats();
  </script>
</body>

</html>